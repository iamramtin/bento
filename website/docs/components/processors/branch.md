---
title: branch
type: processor
beta: true
---

<!--
     THIS FILE IS AUTOGENERATED!

     To make changes please edit the contents of:
     lib/processor/branch.go
-->

BETA: This component is experimental and therefore subject to change outside of
major version releases.

The `branch` processor allows you to create a new request message via
a [Bloblang mapping](/docs/guides/bloblang/about), execute a list of processors
on the request messages, and, finally, map the result back into the source
message using another mapping.

This is useful for preserving the original message contents when using
processors that would otherwise replace the entire contents.

```yaml
# Config fields, showing default values
branch:
  request_map: ""
  processors: []
  result_map: ""
```

If the `request_map` fails the child processors will not be executed
and the message will remain unchanged, and normal processor
[error handling methods](/docs/configuration/error_handling) can be used in
order to filter, DLQ or recover the failed messages.

If the root of your request map is set to `deleted()` then the branch
processors are skipped for the given message, this allows you to conditionally
branch messages.

If the `result_map` fails the message will remain unchanged with an
error and standard [error handling methods](/docs/configuration/error_handling)
can be used in order to filter, DLQ or recover the failed messages.

## Fields

### `request_map`

A [Bloblang mapping](/docs/guides/bloblang/about) that describes how to create a request payload suitable for the child processors of this branch.


Type: `string`  
Default: `""`  

```yaml
# Examples

request_map: |-
  root = {
  	"id": this.doc.id,
  	"content": this.doc.body.text
  }

request_map: |-
  root = if this.type == "foo" {
  	this.foo.request
  } else {
  	deleted()
  }
```

### `processors`

A list of processors to apply to mapped requests. When processing message batches the resulting batch must match the size and ordering of the input batch, therefore filtering, grouping should not be performed within these processors.


Type: `array`  
Default: `[]`  

### `result_map`

A [Bloblang mapping](/docs/guides/bloblang/about) that describes how the resulting messages from branched processing should be mapped back into the original payload.


Type: `string`  
Default: `""`  

```yaml
# Examples

result_map: root.foo_result = this

result_map: |-
  root.bar.body = this.body
  root.bar.id = this.user.id

result_map: |-
  root.enrichments.foo = if errored() {
  	throw(error())
  } else {
  	this
  }
```


