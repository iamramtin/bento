---
title: switch
type: output
categories: ["Utility"]
---

<!--
     THIS FILE IS AUTOGENERATED!

     To make changes please edit the contents of:
     lib/output/switch.go
-->

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';


The switch output type allows you to route messages to different outputs based
on their contents.


<Tabs defaultValue="common" values={[
  { label: 'Common', value: 'common', },
  { label: 'Advanced', value: 'advanced', },
]}>

<TabItem value="common">

```yaml
# Common config fields, showing default values
output:
  switch:
    outputs: []
```

</TabItem>
<TabItem value="advanced">

```yaml
# All config fields, showing default values
output:
  switch:
    retry_until_success: true
    strict_mode: false
    max_in_flight: 1
    outputs: []
```

</TabItem>
</Tabs>

When [batching messages at the input level](/docs/configuration/batching/)
conditional logic is applied across the entire batch. In order to multiplex per
message of a batch use [broker based multiplexing](/docs/components/outputs/about#broker-multiplexing).

## Fields

### `retry_until_success`

If a selected output fails to send a message this field determines whether it is
reattempted indefinitely. If set to false the error is instead propagated back
to the input level.

If a message can be routed to >1 outputs it is usually best to set this to true
in order to avoid duplicate messages being routed to an output.


Type: `bool`  
Default: `true`  

### `strict_mode`

This field determines whether an error should be reported if no condition is met.
If set to true, an error is propagated back to the input level. The default
behavior is false, which will drop the message.


Type: `bool`  
Default: `false`  

### `max_in_flight`

The maximum number of parallel message batches to have in flight at any given time.


Type: `number`  
Default: `1`  

### `outputs`

A list of switch cases, each consisting of an [output](/docs/components/outputs/about),
a [condition](/docs/components/conditions/about) and a field fallthrough,
indicating whether the next case should also be tested if the current resolves
to true.


Type: `array`  
Default: `[]`  

```yaml
# Examples

outputs:
  - condition:
      jmespath:
        query: contains(urls, 'http://benthos.dev')
    fallthrough: false
    output:
      cache:
        key: ${!json("id")}
        target: foo
  - output:
      s3:
        bucket: bar
        path: ${!json("id")}
```

## Examples

In the following example, messages containing "foo" will be sent to both the
`foo` and `baz` outputs. Messages containing "bar" will be
sent to both the `bar` and `baz` outputs. Messages
containing both "foo" and "bar" will be sent to all three outputs. And finally,
messages that do not contain "foo" or "bar" will be sent to the `baz`
output only.

``` yaml
output:
  switch:
    retry_until_success: true
    outputs:
    - output:
        foo:
          foo_field_1: value1
      condition:
        bloblang: content().contains("foo")
      fallthrough: true
    - output:
        bar:
          bar_field_1: value2
          bar_field_2: value3
      condition:
        bloblang: content().contains("bar")
      fallthrough: true
    - output:
        baz:
          baz_field_1: value4
        processors:
        - type: baz_processor
  processors:
  - type: some_processor
```

The switch output requires a minimum of two outputs. If no condition is defined
for an output, it behaves like a static `true` condition. If
`fallthrough` is set to `true`, the switch output will
continue evaluating additional outputs after finding a match.

Messages that do not match any outputs will be dropped. If an output applies
back pressure it will block all subsequent messages.

If an output fails to send a message it will be retried continuously until
completion or service shut down. You can change this behaviour so that when an
output returns an error the switch output also returns an error by setting
`retry_until_success` to `false`. This allows you to
wrap the switch with a `try` broker, but care must be taken to ensure
duplicate messages aren't introduced during error conditions.

